#!/usr/bin/env bash
# Installs the load balancer on ubuntu server lb-01
sudo apt-get update
sudo apt-get install nginx
sudo ufw allow 'Nginx HTTP'
sudo apt-get install --no-install-recommends software-properties-common
sudo add-apt-repository ppa:vbernat/haproxy-1.6
sudo apt-get install haproxy=1.6.\*
sudo chown ubuntu:ubuntu /etc/nginx/sites-available/default
sudo sed -i "/listen 80 default_server/a \\\tupstream backend_servers{server 35.231.58.85:9001;server 35.237.250.218:9002;} ;"
sudo sed -i "/listen 80 default_server/a \\\tproxy_pass http://backend_servers;" /etc/nginx/sites-available/default
